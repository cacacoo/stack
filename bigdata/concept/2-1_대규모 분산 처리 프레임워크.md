# 대규모 분산 처리 프레임워크
분산 처리 프레임워크와 대용량 데이터를 빠르게 쿼리할 수 있는 방법에 대해서 정리한다.

## 언제 분산 처리 프레임워크가 사용될까?
분산 스토리지에 저장되어있는 대량의 데이터를 목적에 따라 사용 가능한 형태의 데이터로 변경하기 위해서 사용된다.

## 분산 스토리지에는 어떤 데이터가 저장될 수 있을까?
- Structured data : 데이터의 형태, 데이터간 관계 등을 스키마로 정의하게된다. Structured data는 스키마가 명확하게 정의된 데이터형을 말한다.
- unstructed data : 자연 언어로 작성된 텍스트 데이터, 이미지, 동영상 등의 스키마가 없는 데이터형이다. 이 상태로는 SQL로 제대로 쿼리할 수 없다.
- schemaless data : CSV, JSON, XML 처럼 기본 서식은 있지만, 스키마 정의가 되지 않는 데이터형이다.

### unstructed, schemaless data 는 structured data로 변형이 필요하다.
분산 스토리지에 수집된 데이터는 명확한 스키마를 갖지 않는 것도 많으므로 그대로는 쿼리할 수 없다.
따라서 일정한 스키마를 가지는 structured data 로 변환이 필요하다.

## 그렇다면 structured data를 어떤 형태로 저장하는게 좋을까?
structured data는 후에 데이터 사용자의 목적에 따라 사용 가능한 형태의 데이터만 따로 쿼리하게 될 것이다.
이 때 쿼리를 빠르게하는 방법에는 두가지가 있다.
- 압축 : 쿼리를 좀 더 빠르게 하기 위해서는 데이터를 좀 더 작게 압축하거나 필요한 데이터만 로드하여 지연을 줄인다.
- 분산 처리 : 여러 컴퓨터 디스크에 분산함으로써 멀티 코어를 활용한 병렬 처리가 가능해진다. 이러한 아키텍처를 Massive Parallel Processing(MPP) 라고 한다.

### 압축 : 열 지향 스토리지 (Column-oriented storage)
열 지향 스토리지는 컬럼단위로 디스크에 저장하는 방식의 스토리지로, 일반적으로 사용하는 행 지향 데이터베이스(Row-oriented database) 와 대응되는 저장 방식이다.

행 지향의 경우, 테이블의 각 행을 하나의 덩어리로 디스크에 저장하므로 새 레코드를 추가할 때 파일의 끝에 데이터를 쓸 뿐이므로 빠르게 추가 가능하다. 따라서 대량의 트랜젝션을 지연 없이 처리하기에 효율적인 것이 특징이다.
또한 검색을 빠르게 하기위해 index를 만들어 사용되나, 데이터 분석에서는 어떤 칼럼이 사용되는지 미리 알 수 없기 떄문에 인덱스는 큰 도움이 되지 못한다.

한편 열 지향 스토리지는 쿼리에 필요한 컬럼만 로드하여 디스크 I/O를 줄이 거나, 같은 컬럼의 유사항 데이터를 압축하는 방법을 통해 쿼리에 있어 행 지향 저장방식보다 이점이 있다.

### 분산 처리 : MPP 아키텍쳐
쿼리 지연을 줄일 수 있는 또 다른 방법은 MPP 아키텍처에 의한 데이터 처리의 병렬화다.
MPP에서는 하나의 쿼리를 다수의 작은 태스크로 분해하여 이를 CPU 별로 병렬로 실행한다.

MPP를 사용한 데이터 집계의 속도는 CPU 코어 수에 비례하며, 디스크로부터 병목 현생이 발생하지 않도록 데이터가 고르게 분산되어 있어야 한다.
이를 최적화한 제품을 MPP 데이터베이스라고 한다.

MPP 아키텍쳐는 하둡과 함께 사용되는 대화형 쿼리 엔진으로도 채택되고 있다.

### MPP와 열 지향 스토리지
두 개념을 결합함으로써 쿼리를 빠르게 할 수 있다. 다만 쿼리의 리소스 사용량도 많이 증가하고 갑작스런 과부화로 인한 장애를 대비해야 한다.