# 하둡, 스파크
분산 시스템의 대표적인 프레임워크인 하둡과 스파크에 대해서 간단하게 정리한다.

## 분산 처리 프레임워크는 왜 필요할까?
앞에서 정리한 내용을 다시 생각해보자.

분산 스토리지에 저장된 비정형 데이터를 쿼리하기 위해서는 많은 시간이 필요하다.
따라서 쿼리를 빠르게 하기 위해, 필요한 데이터를 뽑아서 가공하여 열지향 스토리지로의 이전이 필요하게 된다.(물론 열지향 스토리지로의 이전이 필요할지 아닐지는 상황에 따라 다를것이다.)

이 과정에서는 데이터의 가공 및 압축을 위해 많은 컴퓨터 리소스가 소비되는데 이를 프레임워크화 한 것이 분산 처리 프레임워크다.

## 하둡
하둡은 단일 소프트웨어가 아니라 분산 시스템을 구성하는 다수의 소프트웨어로 이루어진 집합체이다.

### 하둡의 기본 구성 요소
- 분산 파일 시스템 : HDFS(hadoop distributed file system)
- 리소스 관리자 : YARN
- 분산 데이터 처리 : MapReduce, Tez
- 쿼리 엔진 : Hive

모든 분산 시스템이 하둡에 의존하는게 아니라, 이 중 일부만을 상황에 따라 선택할 수 있다.
예를 들어, 분산 파일 시스템으로는 HDFS를 사용하면서 분산 데이터 처리에는 Spark를 구성할 수 있다.

### HDFS
대용량 파일을 분산된 서버에 저장하고, 다수의 컴퓨터에 파일을 복사하여 중복성을 높여 데이터를 빠르게 처리할 수 있게 하는 파일시스템이다.
파일은 특정크기의 블록으로 나누어 분산된 서버에 저장한다.

### YARN
CPU 나 메모리 등의 계산 리소스는 리소스 매니저인 YARN에 의해서 관리된다.
YARN은 애플리케이션이 사용하는 CPU 코어와 메모리를 컨테이너라 불리는 단위로 관리하며, 클러스터 전체의 부하를 보고 비어있는 호스트부터 컨테이너를 할당하는 식이다.

여기서 컨테이너는 도커와 같이 OS 가상화 기술이 아니라, 어떤 호스트에서 어떤 프로세스를 실행시킬 것인지 결정하는 애플리케이션 수준의 기술이다.

### MapReduce
맵리듀스는 YARN 상에서 동작하는 분산 애플리케이션 중 하나로, 분산 시스템에서 데이터 처리를 실행하는 역할을 한다.
임의의 자바 프로그램을 실행시킬 수 있어 비구조화 데이터를 가공하는데 적합하다.

### Tez
테즈는 기존의 맵리듀스를 대체할 목적으로 개발된 프로젝트다.
기존 맵리듀스는 1회의 MapReduce가 끝날 때까지 다음 처리를 기다려야 하는 단점이 있었는데, 이를 보완해서 스테이지 종료를 기다리지 않고 처리가 끝난 데이터를 차례대로 후속 처리에 전달하는 처리하는 특징이 있다.

### Hive
만약 SQL 등을 통한 쿼리 언어에 대한 데이터 집계가 목적이라면 적합한 쿼리 엔진을 사용하면 되는데, 이중 하나가 Hive 이다.
쿼리를 맵리듀스 프로그램으로 변환하는 소프트웨어로 개발되었다. 그렇다고 맵리듀스에만 종속적이지는 않고 MapReduce, Tez, Spark 도 지원할 수 있다.

### 그 밖에
Presto, Impara와 같은 대화 엔진은 YARN을 쓰지 않고, SQL의 실행만 특화한 독자적인 분산 처리를 구현하는 것도 있다.
MPP 데이터베이스처럼 멀티 코어를 활용하면서 가능한 한 많은 데이터 처리를 병렬화해서 빠르게 처리하는 것을 목적으로 하고있다.


## 스파크
맵리듀스 보다 더 효율적인 데이터 처리를 실현하는 프로젝트로 개발되고 있다.
Tez와 달리 스파크는 하둡과는 다른 독립된 프로젝트다. 그래서 리소스 관리 툴로 YARN이 아닌 Mesos를 사용하거나, HDFS 대신 S3를 사용하는 등 다양하게 활용 가능하다.

### 특징
대량의 메모리를 활용하여 빠른 속도로 처리할 수 있도록 한다.

맵리듀스의 경우 처리의 대부분을 디스크의 읽고 쓰기에 사용했는데 이부분은 Tez 또한 마찬가지로, 데이터 처리의 과정에서 만들어진 중간 데이터는 기본적으로 디스크에 기록되었다.

스파크는 컴퓨터에서 취급하는 메모리양이 증가함에 따라, 가능한 많은 데이터를 메모리상에 올려 처리할 수 있게 한다.

### 메모리에 올리면 장애시에는?
장애 등으로 메모리 상의 중간 데이터를 잃어버려도, 한 번더 입력 데이터로 다시 실행하거나, 중간 데이터는 의도적으로 디스크 상에 캐시해둘 수 있다.
























