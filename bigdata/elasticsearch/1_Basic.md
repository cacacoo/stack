# Elasticsearch Basic
엘라스틱서치는 실시간 분산 검색 및 분석 엔진으로, 수평적 확장이 가능하다.
아파치 루씬이라는 기술을 기반으로 검색과 분석을 가능하게 하며, 이는 다른 RDB와 NoSql 솔루션과 구별할 수 있다.

## 엘라스틱서치를 데이터 저장소로써 사용할 때의 특징

### 스키마리스와 도큐먼트 지향
엄격한 데이터 구조를 요구하지 않기 때문에 어떠한 형태의 JSON 도큐먼트도 저장할 수 있다.

### 검색
텍스트 처리 기능이 핵심 강점이다. 특히 full text search(전문 검색)에 특화되어 있다.
전문 검색은 데이터베이스에서 사용할 수 있는 모든 도큐먼트에 대해 어떤 조건이라도 검색할 수 있다는 것을 의미한다.
마치 구글 검색처럼 해당 text가 들어간 모든 도큐먼트를 유사도에 따라 검색할 수 있다.

### 분석
분석을 위해 다양한 집계(aggregation) 기능을 지원한다.

### 클라이언트 라이브러리와 REST API 지원
프로그래밍 언어에서 사용할 수 있는 라이브러리와 Rest API를 가지고 있어 사용에 편리하다.

### 운영 및 확장 용이
수평확장성, 즉 단일 노드든 수백개의 노드든 쉽게 확장이 가능하다.
클러스터에 노드를 추가하는 일은 추가 구성이 거의 필요 없이 같은 네트워크에서 새로운 노드를 시작하기만 하면 된다.
이를 위해서 엘라스틱서치에서 제공하는 기본적인 디스커버리 모듈인 zen discovery를 사용하거나
AWS 클라우드 환경에서는 EC2 discovery 플러그인을 사용하게 된다.

### 거의 실시간
일반적인 경우 저장 및 색인 후에 1초 이내에 쿼리를 통해 이용가능 하다고 한다.

### 신속성
기본적으로 도큐먼트의 모든 필드에 대해 색인을 생성한다. 즉, 어떤 필드든 검색할 수 있다.
아파치 루씬을 기반으로 최적화 속도를 매우 빠르게 했다.

### 결함 허용성
다중 클러스터에서 특정 노드에 장애가 발생해도 지속적인 서비스를 가능하게 하기위해, 샤딩과 복제본을 통해 해결한다.
또한 샤딩과 복제본은 성능향상에도 도움을 준다.


## 핵심 개념

### 인덱스
단일 타입의 도큐먼트를 저장하고 관리하는 컨테이너다. 인덱스의 개념은 데이터베이스의 데이터베이스 스키마와 거의 유사하다.
마찬가지로 타입은 테이블, 도큐먼트는 레코드와 비슷하다. 6.0 부터는 단일 인덱스에는 단일 타입만 가질수 있다.

### cluster
es내 가장 큰 시스템 단위, 여러개의 노드로 이루어진다. 서로다른 클러스터는 데이터 접근이나 교환을 할 수없다.

### 노드
각 하나의 프로세스 단위, cluster name이 같으면 알아서 같은 클러스터로 묶인다.묶인 노드는 서로 데이터를 공유한다. 노드간 데이터 통신은 9300 포트로, http 요청은 9200으로 한다.

### 마스터 노드
전체 클러스터 상태에 대한 메타 정보를 관리하는 노드. elasticsearch.yml에서 node.master 값이 true 인 노드가 마스터 노드로 선출될 수 있다. 후보가 될 수 있다는 뜻. 이쪽에 데이터 요청이 들어올수 있도록, http 포트 열고, kibana, logstash 프로그램을 둔다.

### 데이터 노드
색인된 데이터를 실제로 저장하는 노드이다. node.data : false면 데이터를 저장하지 않는다. http:enabled는 false로 두어 http 접근을 막는다

### 코디네이트 노드
데이터를 저장하지 않고, 애플리케이션과 통신만 담당하는 클라이언트 노드, 데이터 노드 2~3대가 알아서 master를 겸임하도록 하고.

### 샤드
색인된 데이터는 여러 개의 샤드로 분할되 저장, 기본적으로 인덱스당 5개의 샤드와 5개의 복사본으로 분리된다. 샤드된 데이터는 엘라스틱서치가 알아서 각 노드로 분배한다. 처음에 데이터가 색인돼
저장되는 공간을 최초 샤드(primary shard) 라고 한다. 최초 샤드에서 데이터가 색인되고 나면 다시 동일한 최초 샤드 수만큼 복사본을 생성한다.

### 복사본
복사본을 두는 이유는 fail over도 있지만, 동시 검색을 통해서 성능 향상 측면도 있다.

### 멀티캐스트
접근할 수 있는 모든 네트워크의 노드를 자동으로 검색하고, 같은 클러스터명을 가진 노드끼리 바로 바인딩, 이때 노드끼리의 es버젼은 동일해야한다.

### 유니캐스트
접근할 네트워크 주소를 지정해서 지정한 노드 사이에만 바인딩, 이때 노드끼리의 es버젼은 동일해야한다. 의도치 않은 바인딩을 방지하기때문에 사용 권장된다.


## 역색인
역색인은 전문 텍스트 검색을 지원하는 시스템에서 핵심 데이터 구조다. 책의 끝에 나오는 색인 목록과 유사한데, 도큐먼트에 나타난 용어를 도큐먼트에 매핑하는 방식으로 사용한다.

예를 들어 다음과 같이 doc 3개를 저장했다면
```
DOC ID 1 : It is Sunday tomorrow.
DOC ID 2 : Sunday is the last day of week.
DOC ID 3 : The choice is yours.
```

역색인 과정에서 다음과 같은 데이터 구조를 생성한다.
```
choice : DOC 3
day : DOC 2
is: DOC 1, DOC 2, DOC 3
it: DOC 1
last : DOC 2
...
```

### 역색인 절차
- 역색인 시에 도큐먼트의 구두점은 제거되고, 소문자로 치환한 후 분리된 글자를 나타낸다.
- 용어는 알파벳 순으로 정렬된다
- 빈도와 DOC ID가 저장된다

검색이 빠른 이유는 인덱스에서 용어가 정렬되어 있기 때문이다.




